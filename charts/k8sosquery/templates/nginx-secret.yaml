# Create nginx secret
{{- $namespaceYaml := include "k8sosquery.namespace" . }}
{{- $namespace := $namespaceYaml | fromYaml | .namespace }}
{{- if not (lookup "v1" "Secret" $namespace "nginx-secret") }}
apiVersion: v1
kind: Secret
metadata:
  name: nginx-secret
  {{- include "k8sosquery.namespace" . }}
type: Opaque
stringData:
  ca.crt: |
{{ .Values.secrets.nginx_secret | indent 4 }}
{{- else }}
# Secret already exists, skipping creation
{{- end }}